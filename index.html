<section id="song-generator" class="section">
  <h2>ðŸŽµ Song-Video Generator</h2>
  <p>Gib einen Song- oder Videolink ein (YouTube, TikTok, Spotify) und optional einen Text, der auf das Video gelegt wird.</p>
  <input type="text" id="songUrl" placeholder="Song- oder Video-Link">
  <input type="text" id="overlayText" placeholder="Optionaler Text / Copyright">
  <button onclick="generateVideo()">Video generieren</button>
  <p id="videoStatus"></p>
  <a id="downloadLink" href="#" style="display:none" download="video.mp4">Video herunterladen</a>
</section>

<script>
async function generateVideo() {
  const url = document.getElementById('songUrl').value.trim();
  const text = document.getElementById('overlayText').value.trim();
  const status = document.getElementById('videoStatus');
  const downloadLink = document.getElementById('downloadLink');

  if(!url) {
    status.style.color = 'red';
    status.textContent = 'Bitte Link eingeben!';
    return;
  }

  status.style.color = 'black';
  status.textContent = 'Video wird erstellt...';
  downloadLink.style.display = 'none';

  try {
    const res = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url, text })
    });

    if(res.ok) {
      const blob = await res.blob();
      const videoUrl = URL.createObjectURL(blob);
      downloadLink.href = videoUrl;
      downloadLink.style.display = 'inline-block';
      status.style.color = 'green';
      status.textContent = 'Video fertig! Download-Link bereit.';
    } else {
      throw new Error('Fehler beim Erstellen des Videos');
    }
  } catch(err) {
    console.error(err);
    status.style.color = 'red';
    status.textContent = 'Fehler beim Generieren.';
  }
}
</script>
